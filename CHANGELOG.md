# 变更日志

## [v2.0.0] - 2024-12-19

### 🚀 启动脚本完善和文档更新
- **启动脚本优化**: 完善 `start.bat` 自动启动脚本，提供完整的启动流程
- **测试脚本新增**: 新增 `test_start.bat` 测试脚本，用于验证启动环境
- **文档完善**: 更新 `README.md`，添加详细的启动脚本使用说明
- **快速启动指南**: 新增 `QUICK_START.md` 快速启动指南，提供一键启动说明

### ✨ 新增功能
- **环境测试脚本**: `test_start.bat` 提供8项环境检查，确保启动环境正常
- **详细启动说明**: README中添加启动脚本使用说明，包含功能特性和使用方法
- **快速启动文档**: 独立的快速启动指南，提供步骤化的启动说明

### 📚 文档更新
- 在README中添加启动脚本使用说明章节
- 新增启动脚本功能特性说明

- 完善启动流程和注意事项说明

### 🔧 技术改进
- 启动脚本支持自动环境检查和依赖安装

- 完整的错误处理和用户提示

### 📁 新增文件
- `test_start.bat` - 启动脚本测试文件
- `QUICK_START.md` - 快速启动指南文档

### 🎯 用户体验提升
- 一键启动，无需手动配置
- 自动环境检查和修复
- 清晰的启动流程提示
- 完整的故障排除指南

## [v1.5.0] - 2024-12-19

### 🔄 端口配置更新
- **端口号变更**: 将默认端口从8080更改为9000，避免端口冲突
- **配置文件更新**: 更新所有相关配置文件中的端口设置
- **文档同步**: 同步更新README、Configuration等文档中的端口信息

### 📝 具体变更
- `config/settings.py`: 默认端口从8080改为9000
- `app.py`: 更新端口查找和命令行参数的默认值
- `env.example`: 环境变量示例端口更新
- `README.md`: 文档中的端口配置更新
- `wiki/Configuration.md`: Wiki文档端口配置更新

### ⚠️ 注意事项
- 如果之前使用8080端口，请更新为9000端口
- 可以通过环境变量 `SERVER_PORT` 或命令行参数 `--port` 自定义端口
- 确保新端口9000在您的系统中可用

## [v1.4.0] - 2024-12-19

### 🚀 自动启动功能
- **自动启动**: 启动脚本现在会自动启动服务，无需用户手动选择

- **简化操作**: 用户只需双击 `start.bat` 即可完成所有启动步骤
- **版本升级**: 升级到 2.1 自动启动版本

### 🎯 用户体验优化

- **清晰提示**: 显示自动启动的每个步骤和状态

### 📝 脚本更新
- 更新脚本标题为"自动启动脚本"
- 移除用户交互选择代码
- 优化启动流程和提示信息

## [v1.3.0] - 2024-12-19

### 🔄 启动脚本统一化

- **脚本清理**: 删除 `start_web.bat` 和 `start_web.sh` 文件，简化项目结构
- **Windows优化**: 专注于Windows系统，移除Linux/Mac启动脚本

### 🎯 用户体验改进
- **交互式选择**: 启动时提供清晰的模式选择界面
- **统一界面**: 所有启动功能使用一致的界面风格和提示信息
- **错误处理**: 改进的错误处理和用户提示

### 📁 文件结构优化
- 删除 `start_web.bat` 文件
- 删除 `start_web.sh` 文件
- 保留并增强 `start.bat` 作为唯一启动入口

## [v1.2.0] - 2024-12-19

### 🆕 新功能
- **钉钉云盘文件上传**: 集成钉钉Storage 2.0 API，支持文件上传到钉钉云盘
- **文件内容获取**: 新增从钉钉云盘下载文件内容的功能，支持文本文件内容分析
- **智能编码处理**: 自动处理UTF-8、GBK等不同编码格式的文件内容
- **DingTalkDriveService**: 新增专门的钉钉云盘服务类，提供完整的文件管理功能
- **文件类型识别**: 智能识别文本文件和二进制文件，针对不同类型采用不同处理策略

### 🔧 功能增强
- **FileHandler重构**: 重构文件处理器，集成钉钉云盘服务和Dify AI分析
- **配置管理**: 新增文件下载大小限制、钉钉云盘开关等配置选项
- **错误处理**: 增强错误处理机制，提供更详细的日志和用户提示
- **异步支持**: 全链路异步处理，提升性能和响应速度

### 📝 配置更新
- 新增 `MAX_DOWNLOAD_SIZE_MB` 环境变量，控制文件内容下载大小限制
- 新增 `ENABLE_DINGTALK_DRIVE` 环境变量，控制钉钉云盘功能开关
- 更新钉钉云盘相关配置选项，支持更灵活的云盘设置

### 📚 文档
- 新增 `wiki/file-content-guide.md`，详细说明文件内容获取功能的使用方法
- 更新 `wiki/file-upload-guide.md`，补充文件内容获取相关内容
- 完善配置说明和故障排除指南

### 🐛 问题修复
- 修复文件信息提取逻辑，提升文件识别的准确性
- 优化钉钉云盘API调用，减少网络请求失败率
- 改进文件内容编码处理，支持更多编码格式

### ⚠️ 注意事项
- 由于钉钉API限制，文件内容获取功能仅支持已上传到钉钉云盘的文件
- 建议设置合理的 `MAX_DOWNLOAD_SIZE_MB` 值，避免下载过大的文件
- 文件内容会发送给Dify进行AI分析，请确保Dify环境的安全性

## [1.1.0] - 2024-12-18

### 🚀 新增功能

#### 模块化处理器架构
- 重构消息处理逻辑，支持模块化处理器
- 新增 `MessageHandler` 类，统一处理各种消息类型
- 支持 AI 卡片和文本两种回复模式

#### AI 卡片支持
- 集成钉钉 AI 卡片功能
- 支持流式更新和实时交互
- 可配置的卡片模板

#### 改进的配置管理
- 新增 `Settings` 类，集中管理配置
- 支持环境变量和命令行参数
- 配置验证和错误提示

### 🔧 技术改进

#### 代码结构优化
- 重构项目结构，提高代码可维护性
- 新增工具模块：日志、SSL修复、钉钉客户端等
- 统一的异常处理和日志记录

#### 性能优化
- 异步处理支持
- 连接池和重试机制
- 服务器环境自动检测

### 📚 文档更新

- 新增 `README.md` 详细说明
- 新增 `wiki/` 目录，包含配置、API、FAQ等文档
- 更新环境变量配置示例

## [1.0.0] - 2024-12-17

### 🎉 初始版本

#### 核心功能
- 钉钉机器人消息接收和处理
- Dify API 集成，支持聊天和完成模式
- 流式响应支持
- 多种消息类型处理（文本、图片、语音、文件）

#### 基础架构
- 基于 `dingtalk-stream` SDK
- 支持环境变量配置
- 基本的错误处理和日志记录
- Docker 部署支持

---

## 安装说明

### 环境要求
- Python 3.8+
- 钉钉应用配置
- Dify API 密钥

### 快速开始
1. 克隆项目并安装依赖
2. 配置环境变量
3. 运行应用

详细说明请参考 `README.md` 和 `wiki/` 目录中的文档。

## 贡献指南

欢迎提交 Issue 和 Pull Request！

## 许可证

本项目采用 MIT 许可证。